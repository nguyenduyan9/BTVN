(self.wpJsonpPcmallPcpagevoucherdetail=self.wpJsonpPcmallPcpagevoucherdetail||[]).push([[881],{35540:(_,E,e)=>{"use strict";e.r(E),e.d(E,{FETCH_TABS:()=>r,FETCH_VOUCHERS:()=>t,FETCH_RECOMMEND_VOUCHERS:()=>a,VALIDATE_VOUCHERS:()=>n,ADD_RECOMMEND_VOUCHERS:()=>C,MOVE_RECOMMEND_VOUCHER_TO_TOP:()=>R,FETCH_PARTNER_VOUCHERS:()=>s,MARK_PARTNER_VOUCHER:()=>c,SAVE_VOUCHER:()=>i,FETCH_VOUCHER:()=>O,FETCH_BATCH_VOUCHER:()=>T,FETCH_BATCH_VOUCHER_LEGACY:()=>p,CREATE_BATCH_VOUCHER_REQ:()=>H,FETCH_REDEEMED_VOUCHER_BY_TIME:()=>d,CREATE_FETCH_REDEEMED_VOUCHER_BY_TIME_REQ:()=>u,CLAIM_VOUCHER:()=>U,SAVE_PLATFORM_VOUCHER_BY_VOUCHER_CODE:()=>l,FETCH_RECOMMEND_PLATFORM_VOUCHERS:()=>V,SET_VOUCHER_ACTIVE_FILTER_INDEX:()=>S,SET_SHOPEE_VOUCHER_ACTIVE_STATUS_INDEX:()=>y,FETCH_RECOMMEND_LITE_VOUCHERS:()=>A,FETCH_USER_VOUCHER_LIST:()=>M,VOUCHER_WALLET_INIT:()=>D,FETCH_VOUCHER_WALLET_RECOMMENDED_VOUCHERS:()=>h,GET_RECOMMENDED_VOUCHERS_BY_MODEL:()=>v});var o=e(60037);const r="FETCH_TABS",t=(0,o.n)("FETCH_VOUCHERS"),a=(0,o.n)("FETCH_RECOMMEND_VOUCHER"),n=(0,o.n)("VALIDATE_VOUCHERS"),C="ADD_RECOMMEND_VOUCHERS",R="MOVE_RECOMMEND_VOUCHER_TO_TOP",s=(0,o.n)("FETCH_PARTNER_VOUCHERS"),c=(0,o.n)("MARK_PARTNER_VOUCHER"),i=(0,o.n)("SAVE_VOUCHER"),O=(0,o.n)("FETCH_VOUCHER"),T=(0,o.n)("FETCH_BATCH_VOUCHER"),p=(0,o.n)("FETCH_BATCH_VOUCHER_LEGACY"),H="CREATE_BATCH_VOUCHER_REQ",d=(0,o.n)("FETCH_REDEEMED_VOUCHER_BY_TIME"),u="CREATE_FETCH_REDEEMED_VOUCHER_BY_TIME_REQ",U=(0,o.n)("CLAIM_VOUCHER"),l=(0,o.n)("SAVE_PLATFORM_VOUCHER_BY_VOUCHER_CODE"),V=(0,o.n)("FETCH_RECOMMEND_PLATFORM_VOUCHER"),S="SET_VOUCHER_ACTIVE_FILTER_INDEX",y="SET_SHOPEE_VOUCHER_ACTIVE_STATUS_INDEX",A=(0,o.n)("FETCH_RECOMMEND_LITE_VOUCHERS"),M=(0,o.n)("FETCH_USER_VOUCHER_LIST"),D="VOUCHER_WALLET_INIT",h=(0,o.n)("FETCH_VOUCHER_WALLET_RECOMMENDED_VOUCHERS"),v=(0,o.n)("GET_RECOMMENDED_VOUCHERS_BY_MODEL")},34881:(_,E,e)=>{"use strict";e.d(E,{OA:()=>A,Uj:()=>v,ru:()=>F,Q$:()=>V,LN:()=>L,xD:()=>S,Hr:()=>h,gc:()=>M,yQ:()=>m,TT:()=>y,AU:()=>D});var o=e(40235),r=e(71574);const{URL_BATCH_GET_VOUCHER_BY_PRMOTION_ID:t,URL_BATCH_GET_VOUCHER_BY_PRMOTION_ID_LITE:a,URL_GET_PARTNER_VOUCHERS:n,URL_GET_RECOMMEND_VOUCHERS:C,URL_GET_USER_VOUCHER_BY_TIME:R,URL_GET_VOUCHER_BY_PRMOTION_ID:s,URL_GET_VOUCHERS:c,URL_GET_VOUCHERS_LITE:i,URL_MARK_PARTNER_VOUCHERS:O}=o.zH;var T=e(81002),p=e(39381),H=e(39556),d=e(35540),u=e(2417),U=e(99045);function l(){return l=Object.assign?Object.assign.bind():function(_){for(var E=1;E<arguments.length;E++){var e=arguments[E];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(_[o]=e[o])}return _},l.apply(this,arguments)}const V=()=>async _=>{const E=await(0,o.iI)();var e;E.error||_({type:d.FETCH_TABS,payload:null==(e=E.response)?void 0:e.data.tab_info.map((_=>_.user_voucher_list_type))})};function S({orders:_,group_buy_info:E,slash_price_info:e,voucher_market_type:t=r.Tc.DEFAULT_MARKET_PLACE,dp_items:a,check_voucher_payment_criteria:n,selected_payment_channel_data:C,voucher_payment_type:R,spm_channel_id:s,legacy_spm_channel_id:c,card_bin_number:i,need_wallet_active_info:O,isCheckout:p,sorting_flag:H,priority_promotion_ids:u,has_redeem_coins:U}){return async(r,V)=>await(0,T.ZP)({apiCall:()=>o.xD(l({orders:_,group_buy_info:E,slash_price_info:e,voucher_market_type:t,dp_items:a,check_voucher_payment_criteria:n,spm_channel_id:s,legacy_spm_channel_id:c,card_bin_number:i,need_wallet_active_info:O},H?{sorting_flag:H}:{},{priority_promotion_ids:u||[]},C?{selected_payment_channel_data:C}:{},null!=R?{voucher_payment_type:R}:{},{has_redeem_coins:U})),actions:[{type:d.FETCH_RECOMMEND_PLATFORM_VOUCHERS.REQUESTED,payload:()=>({orders:_,isCheckout:p})},{type:d.FETCH_RECOMMEND_PLATFORM_VOUCHERS.SUCCESS,payload:(E,e,o)=>o.data?l({},o.data,{orders:_,isCheckout:p}):{orders:_,isCheckout:p}},{type:d.FETCH_RECOMMEND_PLATFORM_VOUCHERS.FAILED,payload:(E,e,o)=>l({},o.error_response,{error:o.error,orders:_,isCheckout:p})}]},r,V)}const y=({voucher_code:_})=>async(E,e)=>await(0,T.ZP)({apiCall:()=>o.TT({voucher_code:_}),actions:[{type:d.SAVE_PLATFORM_VOUCHER_BY_VOUCHER_CODE.REQUESTED,payload:()=>({voucher_code:_})},{type:d.SAVE_PLATFORM_VOUCHER_BY_VOUCHER_CODE.SUCCESS,payload:(E,e,o)=>o&&o.data?l({},o.data,{voucher_code:_}):{voucher_code:_}},{type:d.SAVE_PLATFORM_VOUCHER_BY_VOUCHER_CODE.FAILED,payload:(E,e,o)=>l({voucher_code:_,error:o.error,error_msg:o.error_msg||o.error_response&&o.error_response.error_msg},o.data)}]},E,e),A=(_,E)=>({type:d.ADD_RECOMMEND_VOUCHERS,voucher:_,voucherType:E}),M=(_,E)=>({type:d.MOVE_RECOMMEND_VOUCHER_TO_TOP,voucherCode:_,voucherType:E}),D=({voucher_code:_,voucher_promotionid:E,promotion_signature:e,source:r,addToWallet:t=!1,need_user_voucher_status:a=!1,need_sz_dfp:n=!1},C)=>async(R,s)=>await(0,T.ZP)({apiCall:()=>(0,o.AU)({voucher_code:_,voucher_promotionid:E,promotion_signature:e,source:r,need_user_voucher_status:a,need_sz_dfp:n}),actions:[{type:d.SAVE_VOUCHER.REQUESTED,payload:()=>({voucher_code:_,voucher_promotionid:E})},{type:d.SAVE_VOUCHER.SUCCESS,payload:(e,o,r)=>r&&r.data?l({},r.data,{voucher_code:_,voucher_promotionid:E,addToWallet:t}):{voucher_code:_,voucher_promotionid:E}},{type:d.SAVE_VOUCHER.FAILED,payload:(e,o,r)=>({voucher_code:_,voucher_promotionid:E,error:r.error,error_msg:r.error_msg||r.error_response&&r.error_response.error_msg,error_config:r.data&&r.data.error_config||null,response:r.data||r.error_response,user_voucher_invalid_status:r.data&&r.data.user_voucher_invalid_status,voucher:r.data&&r.data.voucher?r.data.voucher:void 0,addToWallet:t})}],onSuccess:C},R,s),h=(_,E)=>async(e,r)=>{const t=await(0,T.ZP)({apiCall:()=>function(_,E){const e=`?code_id=${_}&used=${E.toString()}`,r=O+e;return(0,o.Vn)(r)}(_,E),actions:[{type:d.MARK_PARTNER_VOUCHER.REQUESTED,payload:()=>({codeid:_,used:E})},{type:d.MARK_PARTNER_VOUCHER.SUCCESS,payload:(e,o,r)=>l({},r,{codeid:_,used:E})},{type:d.MARK_PARTNER_VOUCHER.FAILED,payload:(_,E,e)=>e}]},e,r);return t},v=(_,E)=>async(e,r)=>await(0,T.ZP)({apiCall:()=>(0,o.vg)(_,E),actions:[{type:d.FETCH_BATCH_VOUCHER.REQUESTED,payload:()=>_},{type:d.FETCH_BATCH_VOUCHER.SUCCESS,payload:(E,e,o)=>({data:o.data,promotionInfo:_})},{type:d.FETCH_BATCH_VOUCHER.FAILED,payload:(E,e,o)=>({error:o.error,promotionInfo:_})}]},e,r);(()=>{const _=[];(0,H.ZP)((E=>{if(_.length>0){const e=_.slice();_.length=0,E(v(e))}}),500)})(),(0,H.ZP)((_=>{_((async(_,E)=>await(0,T.ZP)({apiCall:()=>function(_,E=14,e){const r=new Date;r.setDate(r.getDate()-E);const t=Math.ceil(r.getTime()/1e3);return(0,o.Vn)(`${R}?after_collection_time=${t}${_?"&_mod="+_:""}`,e?{headers:e}:{})}(),actions:[{type:d.FETCH_REDEEMED_VOUCHER_BY_TIME.REQUESTED},{type:d.FETCH_REDEEMED_VOUCHER_BY_TIME.SUCCESS,payload:(_,E,e)=>({data:e.data.promotionids})},{type:d.FETCH_REDEEMED_VOUCHER_BY_TIME.FAILED,payload:(_,E,e)=>({error:e.error})}]},_,E)))}),500);const L=_=>(E,e)=>{const r=e(),t=(0,u.Lf)(r.voucherWallet,_);t&&1===t.progress&&r.voucherWallet.tabs.progress===U.Z.OK||(0,p.Z)({apiCall:()=>o.LN(_),actions:[()=>({type:d.FETCH_USER_VOUCHER_LIST.REQUESTED,payload:{options:_}}),(E,e)=>({type:d.FETCH_USER_VOUCHER_LIST.SUCCESS,payload:{data:e.data,options:_}}),(E,e)=>{const o=e;return{type:d.FETCH_USER_VOUCHER_LIST.FAILED,payload:{options:_,error:o.error,error_msg:o.error_msg||o.message}}}]})(E,e)},m=()=>({type:d.VOUCHER_WALLET_INIT}),F=_=>async E=>{E({type:d.GET_RECOMMENDED_VOUCHERS_BY_MODEL.REQUESTED,payload:{options:_}});const{scene_type:e,voucher_view:t,item_limit:a,limit:n,offset:C,opvOnly:R}=_;let s;s=R?await(0,o.Nb)({pagination:{offset:0,limit:16}}):await(0,o.zz)({scene_type:e,voucher_view:t||r.Q_.VOUCHER_VIEW_DEFAULT,item_limit:a||0,pagination:{offset:C||0,limit:n||100}}),s.error&&E({type:d.GET_RECOMMENDED_VOUCHERS_BY_MODEL.FAILED,payload:{error:s.error,error_msg:s.error_msg,options:_}});const{response:c}=s;if(c){const{data:e,headers:o}=c;E({type:d.GET_RECOMMENDED_VOUCHERS_BY_MODEL.SUCCESS,payload:{headers:o,data:e,options:_}})}return s}},2417:(_,E,e)=>{"use strict";e.d(E,{Eg:()=>n,IA:()=>C,Lf:()=>R,nJ:()=>s,CQ:()=>c,my:()=>i,ow:()=>O});var o=e(71574),r=e(12043),t=e(4790);function a(){return a=Object.assign?Object.assign.bind():function(_){for(var E=1;E<arguments.length;E++){var e=arguments[E];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(_[o]=e[o])}return _},a.apply(this,arguments)}function n(_,E){return _&&_.recommendedVouchers?_.recommendedVouchers[E]:null}function C(_){var E;return null!=(E=null==_?void 0:_.stackablePlatformVoucherCount)?E:1}function R(_,E){const{voucher_status:e,user_voucher_list_type:r=o.h4.ALL,voucher_sort_flag:a=o.Z$.LATEST_SAVE_TIME}=E,n=(0,t.Q5)({user_voucher_list_type:r,voucher_sort_flag:a});return(_.voucherByStatus[e]||{})[n]||{}}const s=(0,r.P1)(R,(_=>_.voucherDetail),((_,E)=>{if(!_)return{};let e;return _&&_.voucherKeys&&(e=_.voucherKeys.map((_=>E[_])).filter(Boolean)),a({},_,{vouchers:e})})),c=(_,E)=>{const{scene_type:e,voucher_view:o}=E,r=`${e}-${o}-${E.opvOnly?"1":"0"}`;return _.voucherWalletRecommendVouchersBySceneView[r]},i=(_,E)=>{const e={};return(E||[]).map((E=>{var o,r;const t=null==(o=E.voucher)||null==(r=o.voucher_identifier)?void 0:r.promotion_id;if(t){var a;const E=null==(a=_.byPromotionIdsNew)?void 0:a[t];e[t]=E}})),e},O=_=>_.voucherMarkedAsUsedStatus}}]);
//# sourceMappingURL=https://sourcemap.webfe.shopeemobile.com/pcmall-voucher/_/881.09459c405da10325c186.js.map