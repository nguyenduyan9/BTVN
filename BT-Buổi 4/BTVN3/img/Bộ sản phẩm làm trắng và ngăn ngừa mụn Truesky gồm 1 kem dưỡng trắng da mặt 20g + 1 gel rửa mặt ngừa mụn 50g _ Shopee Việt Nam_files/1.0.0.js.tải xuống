(self.mfeModules=self.mfeModules||[]).push(["shopee__cart-prefetch-singleton",["Platform","PrometheusTracker","PlatformApi","React"],(e,t,r,o)=>()=>Promise.resolve((()=>{"use strict";var o={651:(o,n,s)=>{s.microfeA(o,(function(){return Promise.all([s.microfeM(0),s.microfeM(1)]).then((function(){o.exports=n,s.r(n),s.d(n,{CartStore:()=>O,prefetchCartAssets:()=>P,prefetchCartData:()=>y});const c=e;var a=s.n(c);const i=r,f=[[1,!0],[2,!0],[4,!0],[7,!0],[8,!0]],d=(e=f)=>e.reduce(((e,[t,r])=>(e&=~(1<<t-1))|+r<<t-1),0);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},l.apply(this,arguments)}const{post:p}=i.FetchUtils;function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},u.apply(this,arguments)}function h(e,t,r){const o=t.map(r),n=e.filter((e=>!o.includes(r(e))));return[...t,...n]}s.microfeI(0),s.microfeI(1);const m=t,_=(0,m.generateCustomReporter)((0,m.generateApmsConfig)({app_name:"pc-cart",secret_key:{live:"9e839f218f760a47e205c124266d1cc0a11be8034b6f64d18eb9794b7650d637",liveish:"9e839f218f760a47e205c124266d1cc0a11be8034b6f64d18eb9794b7650d637",stable:"fe797528d5736a13b321d6f934919a155f453f9582594c0c12d74322e196b93b",staging:"fe797528d5736a13b321d6f934919a155f453f9582594c0c12d74322e196b93b",uat:"fe797528d5736a13b321d6f934919a155f453f9582594c0c12d74322e196b93b",test:"fe797528d5736a13b321d6f934919a155f453f9582594c0c12d74322e196b93b"}[self.__ENV__],app_version:"f42e0e55803f9fcf1080e3cf57093be7821314a1"})),b={"prefetchCart-fullPrefetch":"b68406b24c75b99bd1d7c36bc5f15583","prefetchCart-duration":"2a03dbc2f475c66e6c8ee1645a13f80c"};function g(e,t){return new m.PerformanceTrace(e,t,_,b)}const v="pcmall-cart",O=new class{constructor(e,t){var r=this;this.lastFetchTime=0,this.response=null,this.fetchPromise=null,this.onFetchedSuccess=(e,t)=>{this.response=this.mergeResponseFn(this.response,e),this.lastFetchTime=t},this.fetch=async function(){r.fetchPromise&&r.fetchPromise.cancel();const e=Math.round(Date.now()/1e3);r.fetchPromise=function(e){let t=!1;return{promise:new Promise(((r,o)=>{e.then((e=>t?o({isCancelled:!0}):r(e)),(e=>o(t?{isCancelled:!0}:e)))})),cancel:()=>{t=!0}}}(r.fetchAction(r.lastFetchTime));const t=await r.fetchPromise.promise,{error:o}=t;o||r.onFetchedSuccess(t,e),r.fetchPromise=null},this.fetchAction=e,this.mergeResponseFn=t}}((async function(e){return await(e=>{const t=l({},e,{version:d()});return p("/api/v4/cart/get",t)})({updated_time_filter:{start_time:e}})}),(function(e,t){if(!e||!e.data)return t;if(!t.data)return e;const{shop_orders:r,packaged_item_infos:o}=e.data,{shop_orders:n,packaged_item_infos:s}=t.data;return u({},e,t,{data:u({},e.data,t.data,{shop_orders:h(r,n,(e=>e.shop.shopid)),packaged_item_infos:h(o,s,(e=>e.package_id))})})}));async function y(){if(!function(e){const t=localStorage.getItem("@shopee/cart:be_toggle");return!!t&&(1&Number(t))>0}())return;const e=g("prefetchCart");e.start();const t=Boolean(O.lastFetchTime);e.addAttributes({cached:String(t)}),await O.fetch(),e.markMetric("fullPrefetch"),e.stop()}async function P(){const e=g("prefetchCartAssets");e.start();const t=a().getModuleImmediate(v),r=Boolean(t);e.addAttributes({cached:String(r)});const o=t||await a().getModule(v);return e.markMetric("assetsFetched"),e.stop(),o}}))}))}},n={};function s(e){if(n[e])return n[e].exports;var t=n[e]={exports:{}};return o[e](t,t.exports,s),t.exports}return s.microfeA=(e,t)=>{var r,o,n=e.exports;function s(){r(n)}var c=e.exports=new Promise(((e,t)=>{r=e,o=t}));t().then((()=>{if(e.exports.then){var t=e.exports;e.exports=c,t.then(s,o)}else s()})).catch(o)},(()=>{var t={0:{version:"1.1.19"},1:{version:"1.0.37"}},r={0:"shopee__language",1:"shopee__settings"},o={type:"module",requester:"shopee__cart-prefetch-singleton"};if(s.microfeM=n=>e.getModule(r[n],Object.assign({},o,t[n])),s.microfeI=n=>e.getModuleImmediate(r[n],Object.assign({},o,t[n])),window&&window.__DECKER_HOOK__){var n=window.__DECKER_HOOK__,c=()=>{n.sendToDevtools("MFE_FEDERATED_MODULES_INFO",{base:o,map:t,name:r})};n.on("MFE_RETRIEVE_FEDERATED_MODULES_INFO",c),c()}})(),s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(651)})()).then((t=>{e.setModule("shopee__cart-prefetch-singleton",t,{type:"module",version:"1.0.0",isSingleton:!1})})),2]);